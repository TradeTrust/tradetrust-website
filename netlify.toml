[[redirects]]
  from = "/imd@"
  to = "/imd@/index.html"
  status = 200

[[redirects]]
  from = "/resources"
  to = "/learn"

[[redirects]]
  from = "/contact"
  to = "https://www.form.gov.sg/635f32c5001b2d0011fff09b"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  conditions = { Host = ["ref.tradetrust.io", "dev.tradetrust.io", "deploy-preview-1115--reference-implementation.netlify.app"] }

[[redirects]]
  from = "/*"
  to = "data:text/plain;charset=utf-8,400 Bad Request: Invalid Host Header. This domain is not authorized for TradeTrust."
  status = 400
  force = true

[build]
  ignore = "git log -1 --pretty=%B | grep dependabot"

[[headers]]
  for = "/*"
  [headers.values]
    # Content Security Policy
    Content-Security-Policy = "img-src 'self' blob: data:; frame-ancestors 'self';"
    
    # Permissions Policy - Browser feature access control
    Permissions-Policy = "camera=(), microphone=(), geolocation=(), interest-cohort=(), payment=(), usb=(), bluetooth=(), magnetometer=(), gyroscope=(), accelerometer=(), autoplay=(), encrypted-media=(), fullscreen=(self), picture-in-picture=()"
    
    # Cross-origin protection (CORP + COOP for Spectre mitigation)
    Cross-Origin-Resource-Policy = "same-origin"
    Cross-Origin-Opener-Policy = "same-origin"
    # Cross-Origin-Embedder-Policy omitted - compatibility with Netlify deployment tools

    # Additional security headers
    X-Content-Type-Options = "nosniff"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains"
    X-Frame-Options = "SAMEORIGIN"
    Referrer-Policy = "strict-origin-when-cross-origin"

[[headers]]
  for = "/static/images/favicon/favicon-*"
  [headers.values]
    # Allow cross-origin access for favicon files (needed for MetaMask popup)
    Cross-Origin-Resource-Policy = "cross-origin"
